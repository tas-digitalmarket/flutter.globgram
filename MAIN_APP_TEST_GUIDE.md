# 🎯 راهنمای تست اپلیکیشن اصلی Globgram P2P

## 🚀 مراحل تست (اپلیکیشن اصلی)

### 1️⃣ آماده‌سازی
اپلیکیشن در حال اجرا روی: `http://localhost:8081`

### 2️⃣ تب اول - ایجاد اتاق
1. ✅ باز کنید: `http://localhost:8081`
2. ✅ صفحه "Globgram P2P" بارگذاری می‌شود
3. ✅ روی **"Create Room"** کلیک کنید
4. ✅ Room ID تولید می‌شود (مثل `Q982NY`)
5. ✅ Card با Room ID، QR کد و دکمه‌ها نمایش داده می‌شود
6. ✅ روی **"Copy ID"** کلیک کنید تا Room ID کپی شود
7. ✅ روی **"Join Room"** کلیک کنید
8. ✅ وارد صفحه چت می‌شوید

### 3️⃣ تب دوم - پیوستن به اتاق
1. ✅ **تب جدید** باز کنید: `http://localhost:8081`
2. ✅ در فیلد "Room Name" همان Room ID را paste کنید
3. ✅ روی **"Join Room"** کلیک کنید (فعال می‌شود)
4. ✅ وارد صفحه چت می‌شوید

### 4️⃣ بررسی اتصال
در هر دو تب باید ببینید:
- **Room ID یکسان** در نوار بالا
- **Peer ID متفاوت** برای هر تب
- **وضعیت**: "Connecting" → "Connected"

### 5️⃣ تست ارسال پیام
1. در **تب اول** پیام تایپ کنید: `سلام از تب 1`
2. Enter بزنید یا روی "Send" کلیک کنید
3. **انتظار**: پیام در سمت راست تب 1 ظاهر شود (پیام خودتان)
4. **انتظار**: پیام در سمت چپ تب 2 ظاهر شود (پیام دریافتی)

5. در **تب دوم** پاسخ دهید: `سلام از تب 2`
6. **انتظار**: پیام در سمت راست تب 2 ظاهر شود
7. **انتظار**: پیام در سمت چپ تب 1 ظاهر شود

---

## 🔍 مشاهده لاگ‌ها و عیب‌یابی

### در مرورگر:
1. **F12** بزنید → **Console**
2. لاگ‌های کلیدی:
```
✅ BroadcastSignalingService initialized
📄 Room: Q982NY
📄 Local Peer ID: abcd1234
📤 Sending message: "سلام" from abcd1234
📡 Message broadcast via signaling from abcd1234
🚫 Ignoring own message from abcd1234
✅ Processing message from efgh5678
✅ Chat message received from efgh5678: "سلام"
```

### در اپلیکیشن:
- روی **"View Logs"** کلیک کنید
- لاگ‌های داخلی را مشاهده کنید

---

## ✅ نتیجه انتظاری (اگر درست کار کند)

### تب 1:
```
Room: Q982NY | Peer: abcd1234 | Status: Connected

Messages:
Me: سلام از تب 1          [راست، آبی]
[efgh5678]: سلام از تب 2   [چپ، خاکستری]
```

### تب 2:
```
Room: Q982NY | Peer: efgh5678 | Status: Connected

Messages:
[abcd1234]: سلام از تب 1   [چپ، خاکستری]
Me: سلام از تب 2          [راست، آبی]
```

---

## ❌ مشکلات احتمالی

### مشکل 1: پیام‌ها ارسال نمی‌شوند
**علائم**:
- پیام تایپ می‌کنید اما هیچ‌جا ظاهر نمی‌شود
- در Console error می‌بینید

**بررسی**:
- آیا هر دو تب همان Room ID را دارند؟
- آیا Console لاگ "Message broadcast" نشان می‌دهد؟

### مشکل 2: پیام به خود برمی‌گردد (مشکل اصلی)
**علائم**:
- پیام در هر دو تب ظاهر می‌شود
- Console نشان می‌دهد "Processing message from" خودتان

**علت احتمالی**:
- Singleton pattern برطرف نشده
- Peer ID ها یکسان هستند
- BroadcastChannel درست ignore نمی‌کند

### مشکل 3: تب دوم join نمی‌شود
**علائم**:
- فقط یک peer در لاگ‌ها دیده می‌شود
- پیام‌ها اصلاً رد و بدل نمی‌شوند

**راه‌حل**:
- تب‌ها را refresh کنید
- Room ID را دقیق وارد کنید

---

## 🎯 هدف تست

مشخص کردن که آیا **مشکل "پیام به خود برمی‌گردد"** حل شده است یا خیر.

اگر هنوز مشکل وجود داشته باشد، لاگ‌های Console دقیق نشان خواهد داد که مشکل کجاست.
